/*
 * Solo - A beautiful, simple, stable, fast Java blogging system.
 * Copyright (c) 2010-2018, b3log.org & hacpai.com
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */
var timeline={_COLHA:0,_COLHB:20,_initArticleList:function(){var e=$(".articles");0===e.length||$(".articles > .fn-clear").length>0||($(window).resize(function(){if("auto"===$("#hideTop").css("top")){var t=[timeline._COLHA,timeline._COLHB];e.find("article").each(function(){var e=$(this),a=t[1]>t[0],i=a?t[0]:t[1];parseInt(e.css("top"))===i&&0!==i||(e.css({top:i+"px",position:"absolute"}),this.className=a?"l":"r"),t[a?"0":"1"]+=parseInt(e.outerHeight(!0))}),e.height(t[0]>t[1]?t[0]:t[1])}else e.find("article").each(function(){$(this).css({position:"inherit",top:"auto"}).removeClass("r l")}),e.css("height","auto")}),$(window).resize(),$(".module img").imagesLoaded(function(){$(window).resize()}))},_initIndexList:function(){var e=$(".articles > .fn-clear");if(0!==e.length){var t=0;$(".nav-abs li").each(function(e){var a=$(this);a.hide(),t!==a.data("year")&&(t=a.data("year"),a.before("<li class='close year' onclick='timeline.toggleArchives(this, "+t+")'>"+t+"</li>"))}),$(".article-more").parent().data("count")<=$(".article-more").parent().find("article").length&&$(".article-more").remove(),$(window).resize(function(){e.each(function(){if("auto"===$("#hideTop").css("top")){var e=[timeline._COLHA+60,4*timeline._COLHB],t=$(this).find("article");0===t.length?($(this).find("h2").remove(),$(this).css("margin-bottom",0)):(t.each(function(){var t=$(this),a=e[1]>e[0],i=a?e[0]:e[1];parseInt(t.css("top"))===i&&0!==i||(t.css({top:i+"px",position:"absolute"}),this.className=a?"l":"r"),e[a?"0":"1"]+=parseInt(t.outerHeight(!0))}),$(this).height(e[0]>e[1]?e[0]:e[1]))}else{var t=$(this).find("article");0===t.length?($(this).find("h2").remove(),$(this).css("margin-bottom",0)):(t.each(function(){$(this).css({position:"inherit",top:"auto"}).removeClass("r l")}),$(this).css("height","auto"))}})}),$(window).resize(),$(".module img").imagesLoaded(function(){$(window).resize()})}},_setNavCurrent:function(){$(".header li a").each(function(){$(this).prop("href")===location.href.split("#")[0]?this.className="current":this.className=""})},init:function(){$(window).scroll(function(){$(window).scrollTop()>60?$(".ico-top").show():$(".ico-top").hide()}),timeline._initIndexList(),timeline._initArticleList(),timeline._setNavCurrent(),$(".ico-list").click(function(){"0px"===$(".header > .container > form").css("height")?$(".header > .container > ul, .header > .container > form").css({height:"auto"}):$(".header > .container > ul, .header > .container > form").animate({height:"0px"})})},translate:function(){window.open("http://translate.google.com/translate?sl=auto&tl=auto&u="+location.href)},getArchive:function(e,t,a){var i=e+t,n=e+"/"+t;if(window.location.hash="#"+i,0===$("#"+i+" > article").length){var s=e+" "+Label.yearLabel+" "+t+" "+Label.monthLabel;"en"===Label.localeString.substring(0,2)&&(s=a+" "+e);var r='<h2><span class="article-archive">'+s+'</span></h2><div class="article-more" onclick="timeline.getNextPage(this, \''+n+'\')" data-page="0">'+Label.moreLabel+"</div>";$("#"+i).html(r).css("margin-bottom","50px"),timeline.getNextPage($("#"+i).find(".article-more")[0],n)}},getNextPage:function(e,t){var a=$(e),i=a.data("page")+1,n="/articles/";if(1===$("#tag").length){var s=location.pathname.split("/");n="/articles/tags/"+s[s.length-1]+"/"}else if(1===$("#author").length){var s=location.pathname.split("/");n="/articles/authors/"+s[s.length-1]+"/"}else t&&(n="/articles/archives/"+t+"/");$.ajax({url:latkeConfig.servePath+n+i,type:"GET",beforeSend:function(){a.css("background","url("+latkeConfig.staticServePath+"/skins/timeline/images/ajax-loader.gif) no-repeat scroll center center #60829F").text("")},success:function(e,t){if(!e.sc)return void a.css("background","none #60829F").text("Error");if(0===e.rslts.articles.length)return void a.remove();for(var n="",s=e.rslts.pagination,r=0;r<e.rslts.articles.length;r++){var o=e.rslts.articles[r];n+='<article><div class="module"><div class="dot"></div><div class="arrow"></div><time class="article-time"><span>'+Util.toDate(o.articleCreateTime,"yy-MM-dd HH:mm")+'</span></time><h3 class="article-title"><a rel="bookmark" href="'+latkeConfig.servePath+o.articlePermalink+'">'+o.articleTitle+"</a>",o.hasUpdated&&(n+="<sup>"+Label.updatedLabel+"</sup>"),o.articlePutTop&&(n+="<sup>"+Label.topArticleLabel+"</sup>"),n+="</h3><p>"+o.articleAbstract+'</p><span class="ico-tags ico" title="'+Label.tagLabel+'">';for(var l=o.articleTags.split(","),c=0;c<l.length;c++)n+='<a rel="category tag" href="'+latkeConfig.servePath+"/tags/"+encodeURIComponent(l[c])+'">'+l[c]+"</a>",c<l.length-1&&(n+=",");n+='</span>&nbsp;<span class="ico-author ico" title="'+Label.authorLabel+'"><a rel="author" href="'+latkeConfig.servePath+"/authors/"+o.authorId+'">'+o.authorName+'</a></span>&nbsp;<span class="ico-comment ico" title="'+Label.commentLabel+'"><a rel="nofollow" href="'+latkeConfig.servePath+o.articlePermalink+'#comments">'+(0===o.articleCommentCount?Label.noCommentLabel:o.articleCommentCount)+'</a></span>&nbsp;<span class="ico-view ico" title="'+Label.viewLabel+'"><a rel="nofollow" href="${servePath}${article.articlePermalink}">'+o.articleViewCount+"</a></span></div></article>"}a.before(n).data("page",i),s.paginationPageCount<=i?a.remove():a.css("background","none #60829F").text(Label.moreLabel),$(window).resize(),$(".module img").imagesLoaded(function(){$(window).resize()})}})},toggleArchives:function(e,t){$(".nav-abs li").each(function(a){var i=$(this);i.hasClass("year")||(i.hide(),t===i.data("year")&&$(e).hasClass("close")&&i.show())}),$(".nav-abs li.year").each(function(){parseInt($(this).text())===t?$(e).hasClass("close")?e.className="year open":e.className="year close":this.className="year close"})}};!function(e,t){"use strict";var a="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(t){function i(){var a=e(d),i=e(u);o&&(u.length?o.reject(c,a,i):o.resolve(c)),e.isFunction(t)&&t.call(r,c,a,i)}function n(e){s(e.target,"error"===e.type)}function s(t,s){t.src!==a&&-1===e.inArray(t,h)&&(h.push(t),s?u.push(t):d.push(t),e.data(t,"imagesLoaded",{isBroken:s,src:t.src}),l&&o.notifyWith(e(t),[s,c,e(d),e(u)]),c.length===h.length&&(setTimeout(i),c.unbind(".imagesLoaded",n)))}var r=this,o=e.isFunction(e.Deferred)?e.Deferred():0,l=e.isFunction(o.notify),c=r.find("img").add(r.filter("img")),h=[],d=[],u=[];return e.isPlainObject(t)&&e.each(t,function(e,a){"callback"===e?t=a:o&&o[e](a)}),c.length?c.bind("load.imagesLoaded error.imagesLoaded",n).each(function(t,i){var n=i.src,r=e.data(i,"imagesLoaded");return r&&r.src===n?void s(i,r.isBroken):i.complete&&void 0!==i.naturalWidth?void s(i,0===i.naturalWidth||0===i.naturalHeight):void((i.readyState||i.complete)&&(i.src=a,i.src=n))}):i(),o?o.promise(r):r}}(jQuery),function(){Util.init(),Util.replaceSideEm($(".comments .article-body")),Util.buildTags("tagsSide"),timeline.init()}();